{% extends 'dashboard/base.html' %}

{% block content %}
<div class="container my-4">
	<div class="p-3 p-md-4 rounded-4 shadow-sm form-dark-box form-dark">
		<h3 class="mb-2">Nosotros — Gestión de contenido</h3>
		<div class="inv-accent mb-3"></div>
		<form class="row g-3" action="{{ url_for('admin.admin_nosotros_nuevo') }}" method="POST" enctype="multipart/form-data">
			<div class="col-md-6">
				<label class="form-label">Título</label>
				<input class="form-control" name="titulo" required>
			</div>
			<div class="col-md-3">
				<label class="form-label">Categoría</label>
				<select class="form-select" name="categoria">
					<option value="noticia">Noticia</option>
					<option value="marketing">Marketing</option>
					<option value="descuento">Descuento</option>
				</select>
			</div>
			<div class="col-md-3 d-flex align-items-end">
				<div class="form-check">
					<input class="form-check-input" type="checkbox" name="activo" id="activo" checked>
					<label class="form-check-label" for="activo">Activo</label>
				</div>
			</div>
			<div class="col-12">
				<label class="form-label">Contenido</label>
				<textarea class="form-control" name="contenido" rows="4" required></textarea>
			</div>
			<div class="col-md-6">
				<label class="form-label">Imagen (opcional)</label>
				<input class="form-control" type="file" name="imagen" accept="image/*">
			</div>
			<div class="col-12">
				<button class="btn btn-main" type="submit">Publicar</button>
			</div>
		</form>
	</div>

	<div class="row g-3 g-md-4 mt-3">
		{% for p in posts %}
		<div class="col-12 col-md-6">
			<div class="card h-100">
				{% if p.imagen %}
				<img class="card-img-top" src="{{ url_for('static', filename=p.imagen) }}" alt="{{ p.titulo }}">
				{% endif %}
				<div class="card-body">
					<div class="d-flex justify-content-between align-items-start mb-2">
						<h5 class="card-title mb-0">{{ p.titulo }}</h5>
						<span class="badge {% if p.activo %}bg-success{% else %}bg-secondary{% endif %}">{{ 'Activo' if p.activo else 'Inactivo' }}</span>
					</div>
					<div class="text-muted small mb-2">{{ p.categoria|capitalize }} • {{ p.creado_en }}</div>
					<p class="card-text">{{ p.contenido }}</p>
					<div class="d-flex gap-2">
						<button class="btn btn-outline-primary btn-sm" data-bs-toggle="collapse" data-bs-target="#edit{{ p.id }}">Editar</button>
						<form method="POST" action="{{ url_for('admin.admin_nosotros_eliminar', pid=p.id) }}" onsubmit="return confirm('¿Eliminar este contenido?')">
							<button class="btn btn-outline-danger btn-sm" type="submit">Eliminar</button>
						</form>
					</div>
					<div class="collapse mt-3" id="edit{{ p.id }}">
						<form class="row g-2" method="POST" action="{{ url_for('admin.admin_nosotros_editar', pid=p.id) }}" enctype="multipart/form-data">
							<div class="col-12"><input class="form-control" name="titulo" value="{{ p.titulo }}"></div>
							<div class="col-6">
								<select class="form-select" name="categoria">
									{% for opt in ['noticia','marketing','descuento'] %}
									<option value="{{ opt }}" {% if p.categoria==opt %}selected{% endif %}>{{ opt|capitalize }}</option>
									{% endfor %}
								</select>
							</div>
							<div class="col-6 d-flex align-items-center">
								<div class="form-check">
									<input class="form-check-input" type="checkbox" name="activo" id="a{{ p.id }}" {% if p.activo %}checked{% endif %}>
									<label class="form-check-label" for="a{{ p.id }}">Activo</label>
								</div>
							</div>
							<div class="col-12"><textarea class="form-control" rows="3" name="contenido">{{ p.contenido }}</textarea></div>
							<div class="col-12"><input class="form-control" type="file" name="imagen" accept="image/*"></div>
							<div class="col-12"><button class="btn btn-primary btn-sm" type="submit">Guardar</button></div>
						</form>
					</div>
				</div>
			</div>
		</div>
		{% else %}
			<div class="col-12"><div class="text-muted">Sin contenido aún. ¡Publica el primero!</div></div>
		{% endfor %}
	</div>
</div>
{% endblock %}
