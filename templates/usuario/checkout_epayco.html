{% extends 'usuario/base.html' %}

{% block content %}
<div class="container py-5" style="max-width: 720px;">
  <h2 class="mb-3">Confirmar pago</h2>
  <p class="text-muted">Reserva #{{ reserva.id }} · {{ reserva.check_in }} → {{ reserva.check_out }}</p>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <div class="fw-semibold">Habitación {{ habitacion.nombre if habitacion else ('#'+(reserva.habitacion_id|string)) }} · Total</div>
          <div class="small text-muted">Se procesará en ePayco {{ 'Sandbox' if test=='true' else '' }}</div>
        </div>
        <div class="fs-4 fw-bold">${{ '%.0f'|format(reserva.total or 0) }} COP</div>
      </div>

      {% if not epayco_public_key %}
      <div class="alert alert-danger">Falta configurar EPAYCO_PUBLIC_KEY en el entorno.</div>
      {% endif %}

      <form id="epayco-form" onsubmit="return false;">
        <script src="https://checkout.epayco.co/checkout.js"
          class="epayco-button"
          data-epayco-key="{{ epayco_public_key }}"
          data-epayco-amount="{{ '%.2f'|format(amount) }}"
          data-epayco-name="{{ title }}"
          data-epayco-description="{{ description }}"
          data-epayco-currency="{{ currency|upper }}"
          data-epayco-country="{{ country|upper }}"
          data-epayco-test="{{ test }}"
          data-epayco-invoice="{{ invoice }}"
          data-epayco-external="true"
          data-epayco-response="{{ response_url }}"
          data-epayco-confirmation="{{ confirm_url }}"
          data-epayco-autoclick="true">
        </script>
      </form>

      <div class="mt-3">
        <a href="{{ url_for('perfil_usuario.perfil') }}" class="btn btn-outline-secondary">Cancelar</a>
      </div>
    </div>
  </div>
  <div class="alert alert-info mt-3">
    Este flujo puede operar en modo prueba activando EPAYCO_TEST=1.
  </div>
</div>
{% endblock %}
